---
import { SITE_TITLE } from "../consts";
---

<header
  transition:persist
  class="site-header sticky top-0 z-50 bg-white border-b border-gray-300"
>
  <div class="max-w-3xl mx-auto px-4 py-4 flex items-center justify-between">
    <a
      href="/"
      class="site-title text-xl font-bold text-gray-800 no-underline hover:text-gray-600"
    >
      {SITE_TITLE}
    </a>

    <nav class="site-nav relative">
      <button
        id="menu-toggle"
        class="menu-icon md:hidden p-2"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg viewBox="0 0 18 15" class="w-5 h-4">
          <path
            fill="#424242"
            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"
          ></path>
          <path
            fill="#424242"
            d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"
          ></path>
          <path
            fill="#424242"
            d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"
          ></path>
        </svg>
      </button>

      <!-- Desktop menu -->
      <div class="hidden md:flex gap-4">
        <a
          href="/about"
          class="page-link text-gray-600 hover:text-gray-900 no-underline"
          >About</a
        >
      </div>

      <!-- Mobile menu dropdown -->
      <div
        id="mobile-menu"
        class="mobile-menu hidden absolute right-0 top-full mt-2 bg-white border border-gray-300 rounded-lg shadow-lg py-2 min-w-32 md:hidden"
      >
        <a
          href="/about"
          class="block px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 no-underline"
          >About</a
        >
      </div>
    </nav>
  </div>
</header>

<script>
  // Use event delegation on document to handle clicks
  // This works reliably with transition:persist since we're not adding
  // listeners to the persisted elements themselves
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;
    const toggle = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");

    if (!toggle || !menu) return;

    // Handle hamburger button click
    if (toggle.contains(target)) {
      const isOpen = menu.classList.contains("hidden");
      menu.classList.toggle("hidden");
      toggle.setAttribute("aria-expanded", isOpen.toString());
      return;
    }

    // Handle menu link click - close menu
    if (menu.contains(target) && target.tagName === "A") {
      menu.classList.add("hidden");
      toggle.setAttribute("aria-expanded", "false");
      return;
    }

    // Click outside - close menu
    if (!menu.contains(target)) {
      menu.classList.add("hidden");
      toggle.setAttribute("aria-expanded", "false");
    }
  });
</script>
